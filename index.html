<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>심리 테스트</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            margin: 0; 
            height: 100vh; 
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat; 
            background-attachment: fixed; /* 배경 고정 */
        }
        
        /* 홈 페이지 배경 설정 */
        .home-background {
            background-image: url('background/home.png'); /* 홈 배경 이미지 */
        }
        
        /* 테스트 페이지 배경 설정 */
        .test-background {
            background-image: url('background/test.png'); /* 테스트 배경 이미지 */
        }

        /* 결과 페이지 배경 설정 */
        .result-background {
            background-image: url('background/result.png'); /* 결과 배경 이미지 */
        }
        
        .question, .result, .image-viewer, .test-section { 
            display: none; 
            margin: 20px 0; 
        }
        
        .image-viewer img { 
            width: 100%; 
            max-width: 600px; 
        }
        
        button { 
            margin-top: 10px; 
            padding: 10px; 
        }
        
        .menu { 
            margin-top: 50px; 
        }
        
        .navigation-buttons { 
            margin-top: 20px; 
        }
        
        /* 진행 상태 표시 바 스타일 */
        .progress-container {
            width: 80%;
            background-color: #f3f3f3;
            border-radius: 25px;
            margin: 20px auto;
        }
        
        .progress-bar {
            height: 30px;
            width: 0%;
            background-color: #4caf50;
            text-align: center;
            line-height: 30px;
            color: white;
            border-radius: 25px;
        }
    </style>
</head>
<body class="home-background"> <!-- 기본적으로 홈 페이지 배경을 설정 -->
    <h1>심리 테스트 및 결과 확인</h1>
    
    <!-- 첫 화면 메뉴 -->
    <div class="menu">
        <button onclick="showResultPage()">결과 확인</button>
        <button onclick="startTest()">심리테스트 시작</button>
    </div>

    <!-- 결과 확인 페이지 -->
    <div class="result">
        <h2>결과 확인</h2>
        <!-- 이미지 파일 경로를 사용하여 결과 표시 -->
        <button onclick="showImage('0-30')">0-30</button>
        <button onclick="showImage('40-70')">40-70</button>
        <button onclick="showImage('80-100')">80-100</button>
        <div class="image-viewer">
            <img id="result-image" src="" alt="심리 테스트 결과 이미지">
        </div>
        <div class="navigation-buttons">
            <button id="home-btn" onclick="goHome()">홈으로 돌아가기</button>
        </div>
        <button id="download-btn" style="display:none;" onclick="downloadPDF()">결과 PDF 다운로드</button>
        <button id="print-btn" style="display:none;" onclick="printPDF()">결과 인쇄</button>
        <button id="kakao-share-btn" style="display:none;" onclick="shareKakao()">카카오톡으로 결과 공유</button>
    </div>

    <!-- 심리 테스트 섹션 -->
    <div class="test-section">
        <h2>심리 테스트</h2>
        <!-- 진행 상태 표시 바 -->
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar">0%</div>
        </div>
        <div id="test-container"></div>
        <button id="submit-test" style="display:none;" onclick="submitTest()">결과 제출</button>
    </div>

    <!-- Kakao SDK -->
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script>
        // Kakao SDK 초기화 (발급받은 앱 키 사용)
        Kakao.init('c817ee8f357d0b759f84810124efd582'); // 실제 앱 키로 교체하세요.
        console.log(Kakao.isInitialized()); // 초기화 확인

        // 이미지 파일 경로 설정
        const imagePaths = {
            '0-30': 'image/0_30.png',  // 결과 이미지 경로
            '40-70': 'image/40_70.png',
            '80-100': 'image/80_100.png'
        };

        // PDF 파일 경로 설정
        const pdfPaths = {
            '0-30': 'pdf/result_0_to_30.pdf',  // PDF 파일 경로
            '40-70': 'pdf/result_40_to_70.pdf',
            '80-100': 'pdf/result_80_to_100.pdf'
        };

        let currentResult = ''; // 현재 결과를 저장하는 변수
        const totalQuestions = 10; // 총 문제 수
        let currentQuestionIndex = 0; // 현재 질문 인덱스
        let answers = {}; // 사용자 답변 저장
        const questions = [
            {
                question: '다른 사람과 잘 어울리는 편인가요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 1 // 정답 인덱스 (0부터 시작)
            },
            {
                question: '어려운 문제를 해결하는 것을 좋아하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 2
            },
            {
                question: '어떤 일을 할 때 완벽하게 하려고 하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 0
            },
            {
                question: '모임에서 리더 역할을 자주 하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 3
            },
            {
                question: '계획을 세우고 실행하는 것을 좋아하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 1
            },
            {
                question: '새로운 것을 배우는 것을 좋아하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 0
            },
            {
                question: '감정을 잘 표현하는 편인가요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 4
            },
            {
                question: '여행을 자주 다니는 편인가요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 1
            },
            {
                question: '책을 자주 읽는 편인가요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 3
            },
            {
                question: '운동을 좋아하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 0
            }
        ];

        // 초기 화면 설정
        function showResultPage() {
            document.body.className = 'result-background'; // 결과 페이지 배경 설정
            document.querySelector('.menu').style.display = 'none';
            document.querySelector('.result').style.display = 'block';
        }

        function startTest() {
            document.body.className = 'test-background'; // 테스트 페이지 배경 설정
            document.querySelector('.menu').style.display = 'none';
            document.querySelector('.test-section').style.display = 'block';
            generateTestQuestions();
            updateProgressBar(); // 초기 진행 상태 업데이트
        }

        // URL 파라미터로 결과 표시
        function getParameterByName(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }

        function showImage(resultKey) {
            const imagePath = imagePaths[resultKey];
            document.getElementById('result-image').src = imagePath;
            document.querySelector('.image-viewer').style.display = 'block';
            document.getElementById('download-btn').style.display = 'block';
            document.getElementById('print-btn').style.display = 'block';
            document.getElementById('kakao-share-btn').style.display = 'block';
            document.getElementById('home-btn').style.display = 'block'; // 홈으로 돌아가기 버튼 표시
            currentResult = resultKey; // 현재 결과 저장
            updateURL(resultKey); // URL 업데이트
        }

        // URL 업데이트 함수
        function updateURL(resultKey) {
            const newUrl = `${window.location.origin}${window.location.pathname}?result=${resultKey}`;
            window.history.replaceState({ path: newUrl }, '', newUrl);
        }

        // 페이지 로드 시 URL의 파라미터 확인
        window.onload = function() {
            const resultParam = getParameterByName('result');
            if (resultParam) {
                showResultPage();
                showImage(resultParam);
            }
        };

        function downloadPDF() {
            const pdfLink = pdfPaths[currentResult];
            const link = document.createElement('a');
            link.href = pdfLink;
            link.download = `${currentResult}_result.pdf`;
            link.click();
        }

        function printPDF() {
            const pdfLink = pdfPaths[currentResult];
            const printWindow = window.open(pdfLink, '_blank');
            printWindow.onload = function() {
                printWindow.print();
            };
        }

        function shareKakao() {
            const result = `심리 테스트 결과를 확인하세요! (${currentResult})`;
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: '심리 테스트 결과',
                    description: result,
                    imageUrl: imagePaths[currentResult],  // 결과 이미지 사용
                    link: {
                        mobileWebUrl: window.location.href,  // 현재 페이지의 고유 링크 사용
                        webUrl: window.location.href  // 데스크탑 웹 URL
                    }
                },
                buttons: [
                    {
                        title: '결과 확인하기',
                        link: {
                            mobileWebUrl: window.location.href,
                            webUrl: window.location.href
                        }
                    }
                ]
            }).then(function() {
                alert('카카오톡으로 공유하기 성공!');
            }).catch(function(error) {
                alert('카카오톡 공유 실패: ' + JSON.stringify(error));
            });
        }

        // 심리테스트 질문 생성
        function generateTestQuestions() {
            const testContainer = document.getElementById('test-container');
            testContainer.innerHTML = '';

            questions.forEach((questionObj, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question');
                questionDiv.innerHTML = `<p>${index + 1}. ${questionObj.question}</p>`;
                questionObj.choices.forEach((choice, choiceIndex) => {
                    questionDiv.innerHTML += `<button onclick="selectAnswer(${index}, ${choiceIndex})">${choice}</button> `;
                });
                testContainer.appendChild(questionDiv);
            });

            document.querySelectorAll('.question')[0].style.display = 'block'; // 첫 번째 질문 표시
        }

        function selectAnswer(questionNumber, answerIndex) {
            answers[questionNumber] = answerIndex;
            // 각 문제마다 사용자가 선택지를 선택하면 다음 문제로 이동하도록 설정
            if (questionNumber + 1 < totalQuestions) {
                document.querySelectorAll('.question')[questionNumber].style.display = 'none';
                document.querySelectorAll('.question')[questionNumber + 1].style.display = 'block';
                currentQuestionIndex++; // 현재 질문 인덱스 업데이트
                updateProgressBar(); // 진행 상태 업데이트
            } else {
                document.getElementById('submit-test').style.display = 'block'; // 마지막 문제 이후에는 제출 버튼을 표시
                updateProgressBar(); // 마지막 질문 진행 상태 업데이트
            }
        }

        function submitTest() {
            let score = 0;
            for (let i = 0; i < totalQuestions; i++) {
                if (answers[i] === questions[i].correctAnswer) {
                    score += 10; // 정답당 10점씩 부여
                }
            }

            let resultKey;
            if (score <= 30) {
                resultKey = '0-30';
            } else if (score <= 70) {
                resultKey = '40-70';
            } else {
                resultKey = '80-100';
            }

            // 결과 페이지 배경으로 변경
            document.body.className = 'result-background'; 

            showImage(resultKey);
            document.querySelector('.test-section').style.display = 'none';
            document.querySelector('.result').style.display = 'block';
        }

        // 진행 상태 업데이트 함수
        function updateProgressBar() {
            const progressBar = document.getElementById('progress-bar');
            const progressPercentage = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            progressBar.style.width = progressPercentage + '%';
            progressBar.innerText = Math.round(progressPercentage) + '%';
        }

        // 홈으로 돌아가기 버튼 기능
        function goHome() {
            document.body.className = 'home-background'; // 홈 페이지 배경 설정
            document.querySelector('.result').style.display = 'none';
            document.querySelector('.test-section').style.display = 'none';
            document.querySelector('.menu').style.display = 'block';
            
            // 모든 상태 초기화
            currentQuestionIndex = 0; // 진행 상태 초기화
            answers = {}; // 답변 초기화
            document.getElementById('test-container').innerHTML = ''; // 테스트 컨테이너 초기화
            updateProgressBar(); // 진행 상태 바 초기화
            document.getElementById('result-image').src = ''; // 결과 이미지 초기화
            document.querySelector('.image-viewer').style.display = 'none'; // 결과 이미지 뷰어 숨기기
            document.getElementById('download-btn').style.display = 'none'; // 다운로드 버튼 숨기기
            document.getElementById('print-btn').style.display = 'none'; // 인쇄 버튼 숨기기
            document.getElementById('kakao-share-btn').style.display = 'none'; // 공유 버튼 숨기기

            // URL 초기화
            window.history.replaceState({}, document.title, window.location.pathname); 
        }
    </script>
</body>
</html>
