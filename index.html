<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>심리 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .question, .result, .image-viewer, .test-section { display: none; margin: 20px 0; }
        .image-viewer img { width: 100%; max-width: 600px; }
        button { margin-top: 10px; padding: 10px; }
        .menu { margin-top: 50px; }
    </style>
</head>
<body>
    <h1>심리 테스트 및 결과 확인</h1>
    
    <!-- 첫 화면 메뉴 -->
    <div class="menu">
        <button onclick="showResultPage()">결과 확인</button>
        <button onclick="startTest()">심리테스트 시작</button>
    </div>

    <!-- 결과 확인 페이지 -->
    <div class="result">
        <h2>결과 확인</h2>
        <!-- 이미지 파일 경로를 사용하여 결과 표시 -->
        <button onclick="showImage('0-30')">0-30</button>
        <button onclick="showImage('40-70')">40-70</button>
        <button onclick="showImage('80-100')">80-100</button>
        <div class="image-viewer">
            <img id="result-image" src="" alt="심리 테스트 결과 이미지">
        </div>
        <button id="download-btn" style="display:none;" onclick="downloadPDF()">결과 PDF 다운로드</button>
        <button id="print-btn" style="display:none;" onclick="printPDF()">결과 인쇄</button>
        <button id="kakao-share-btn" style="display:none;" onclick="shareKakao()">카카오톡으로 결과 공유</button>
    </div>

    <!-- 심리 테스트 섹션 -->
    <div class="test-section">
        <h2>심리 테스트</h2>
        <div id="test-container"></div>
        <button id="submit-test" style="display:none;" onclick="submitTest()">결과 제출</button>
    </div>

    <!-- Kakao SDK -->
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script>
        // Kakao SDK 초기화 (발급받은 앱 키 사용)
        Kakao.init('c817ee8f357d0b759f84810124efd582'); // 실제 앱 키로 교체하세요.
        console.log(Kakao.isInitialized()); // 초기화 확인

        // 이미지 파일 경로 설정
        const imagePaths = {
            '0-30': 'image/0_30.png',  // 결과 이미지 경로
            '40-70': 'image/40_70.png',
            '80-100': 'image/80_100.png'
        };

        // PDF 파일 경로 설정
        const pdfPaths = {
            '0-30': 'https://drive.google.com/uc?export=download&id=1Puvflh-iprr6Uc-2_ERsqEZ6LWgXcCHi',  // PDF 파일 경로
            '40-70': 'pdf/result_40_to_70.pdf',
            '80-100': 'https://drive.google.com/uc?export=download&id=1Puvflh-iprr6Uc-2_ERsqEZ6LWgXcCHi'
        };

        let currentResult = ''; // 현재 결과를 저장하는 변수

        // 초기 화면 설정
        function showResultPage() {
            document.querySelector('.menu').style.display = 'none';
            document.querySelector('.result').style.display = 'block';
        }

        function startTest() {
            document.querySelector('.menu').style.display = 'none';
            document.querySelector('.test-section').style.display = 'block';
            generateTestQuestions();
        }

        function showImage(resultKey) {
            const imagePath = imagePaths[resultKey];
            document.getElementById('result-image').src = imagePath;
            document.querySelector('.image-viewer').style.display = 'block';
            document.getElementById('download-btn').style.display = 'block';
            document.getElementById('print-btn').style.display = 'block';
            document.getElementById('kakao-share-btn').style.display = 'block';
            currentResult = resultKey; // 현재 결과 저장
        }

        function downloadPDF() {
            const pdfLink = pdfPaths[currentResult];
            const link = document.createElement('a');
            link.href = pdfLink;
            link.download = `${currentResult}_result.pdf`;
            link.click();
        }

        function printPDF() {
            const pdfLink = pdfPaths[currentResult];
            const printWindow = window.open(pdfLink, '_blank');
            printWindow.onload = function() {
                printWindow.print();
            };
        }

        function shareKakao() {
            const result = `심리 테스트 결과를 확인하세요! (${currentResult})`;
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: '심리 테스트 결과',
                    description: result,
                    imageUrl: imagePaths[currentResult],  // 결과 이미지 사용
                    link: {
                        mobileWebUrl: window.location.href,  // 현재 페이지의 고유 링크 사용
                        webUrl: window.location.href  // 데스크탑 웹 URL
                    }
                },
                buttons: [
                    {
                        title: '결과 확인하기',
                        link: {
                            mobileWebUrl: window.location.href,
                            webUrl: window.location.href
                        }
                    }
                ]
            }).then(function() {
                alert('카카오톡으로 공유하기 성공!');
            }).catch(function(error) {
                alert('카카오톡 공유 실패: ' + JSON.stringify(error));
            });
        }

        // 심리테스트 질문 생성
        function generateTestQuestions() {
            const testContainer = document.getElementById('test-container');
            testContainer.innerHTML = '';
            for (let i = 1; i <= 10; i++) {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question');
                questionDiv.innerHTML = `<p>${i}. 임시 질문 ${i}의 선택지를 고르세요:</p>`;
                for (let j = 1; j <= 5; j++) {
                    questionDiv.innerHTML += `<button onclick="selectAnswer(${i}, ${j})">선택지 ${j}</button> `;
                }
                testContainer.appendChild(questionDiv);
            }
            document.getElementById('submit-test').style.display = 'block';
        }

        let answers = {}; // 사용자 답변 저장

        function selectAnswer(questionNumber, answer) {
            answers[questionNumber] = answer;
        }

        function submitTest() {
            const correctAnswers = Object.keys(answers).filter(key => answers[key] === 3).length; // 예시로 정답을 3번 선택으로 설정
            let resultKey;
            if (correctAnswers <= 3) {
                resultKey = '0-30';
            } else if (correctAnswers <= 7) {
                resultKey = '40-70';
            } else {
                resultKey = '80-100';
            }
            showImage(resultKey);
            document.querySelector('.test-section').style.display = 'none';
            document.querySelector('.result').style.display = 'block';
        }
    </script>
</body>
</html>
