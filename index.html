<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>심리 테스트</title>
    <style>
        /* 공통 스타일 */
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 0;
            min-height: 100vh; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #000; /* 기본 텍스트 색상 */
            text-align: center;
            overflow: hidden; /* 홈 화면에서 스크롤 방지 */
        }

        /* 페이지별 배경 이미지 설정 */
        body.home-background { 
            background-color: #f8f2e5; /* 홈 페이지 배경색 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative; /* 홈화면 디자인에 필요한 위치 설정 */
            overflow: hidden; /* 홈 화면에서 스크롤 방지 */
        }

        body.test-background, body.result-background {
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat; 
            background-attachment: fixed; /* 배경 고정 */
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            overflow: auto; /* 테스트 및 결과 페이지는 스크롤 가능 */
            background-color: #f8f7f2; /* 테스트 및 결과 페이지 배경색 변경 */
            color: #000; /* 테스트 및 결과 페이지 텍스트 색상 변경 */
        }

        /* 홈 페이지 스타일 (홈화면 디자인 통합) */
        #home-screen {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center; /* 수직 중앙 정렬 */
            align-items: center;
            min-height: 100vh; /* 최소 높이를 100%로 설정 */
            box-sizing: border-box;
            padding: 20px;
        }

        .header {
            border: 2px solid black; /* 검은색 테두리 */
            border-radius: 15px;
            padding: 10px;
            display: inline-block;
            background-color: #f8f2e5; /* 배경색과 같은 색 */
            position: absolute; /* 절대 위치 설정 */
            top: 20px; /* 상단 위치 */
            left: 20px; /* 좌측 위치 */
        }

        .image-container {
            display: flex;
            justify-content: center;
            margin-bottom: 10px; /* 긴 선과의 간격 */
        }

        .image-container img {
            width: 60%; /* 이미지 너비 조정 */
            max-width: 2000px;
            height: auto;
        }

        .main-line {
            border-top: 2px solid black;
            width: 80%; /* 너비를 80%로 설정하여 양쪽 여백 추가 */
            margin: 10px auto; /* 위 아래 여백 추가 및 중앙 정렬 */
        }

        .button-container {
            display: flex;
            justify-content: space-between; /* 버튼들을 양쪽 끝으로 배치 */
            width: 80%; /* 버튼 컨테이너 너비를 긴 선과 맞춤 */
            margin: 20px auto; /* 중앙 정렬 */
        }

        .button {
            display: flex;
            border: 2px solid black;
            padding: 0; /* 패딩 제거 */
            cursor: pointer;
            transition: background-color 0.3s;
            height: 40px; /* 버튼 높이 */
            position: relative; /* 호버 효과를 위한 상대 위치 설정 */
        }

        .button.left {
            flex-direction: row; /* 가로 방향으로 정렬 */
            width: 150px; /* 버튼의 너비 */
        }

        .left-arrow {
            width: 40%; /* 왼쪽 화살표 영역 비율 */
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent; /* 기본 배경색 */
            transition: background-color 0.3s; /* 호버 시 배경 변화 효과 */
        }

        .button.left:hover .left-arrow {
            background-color: #d3d3d3; /* 버튼 전체 호버 시 화살표 부분 호버 시 회색으로 변경 */
        }

        .separator {
            border-left: 2px solid black; /* 검은색 구분선 */
            height: 100%; /* 버튼 높이에 맞춤 */
        }

        .right-button {
            display: flex;
            flex-direction: row; /* 가로 방향으로 정렬 */
            width: 150px; /* 버튼의 너비 */
        }

        .right-text {
            width: 60%; /* 오른쪽 텍스트 영역 비율 */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px; /* 글자 크기 조정 */
        }

        .right-arrow {
            width: 40%; /* 오른쪽 화살표 영역 비율 */
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent; /* 기본 배경색 */
            transition: background-color 0.3s; /* 호버 시 배경 변화 효과 */
        }

        .button.right:hover .right-arrow {
            background-color: #d3d3d3; /* 회색으로 변경 */
        }

        .footer {
            border: 2px solid black;
            background-color: #d3d3d3;
            padding: 10px; /* 패딩 줄임 */
            font-size: 12px; /* 글씨 크기 줄임 */
            width: 80%; /* 폭을 줄여서 한 줄로 보이게 */
            margin: 20px auto; /* 중앙 정렬 */
            position: absolute; /* 절대 위치 설정 */
            bottom: 20px; /* 하단 위치 조정 */
            left: 50%; /* 중앙 정렬 */
            transform: translateX(-50%); /* 중앙 정렬을 위해 이동 */
        }

        /* 테스트 페이지 스타일 */
        .test-section {
            display: none;
            width: 100%;
            max-width: 800px;
            padding: 20px;
            box-sizing: border-box;
            background-color: #f8f7f2;
            color: #000;
            text-align: center;
            position: relative; /* 버튼을 절대 위치로 배치하기 위해 추가 */
        }

        .test-section .progress-bar {
            width: 80%;
            height: 10px;
            background-color: #f0f0f0;
            margin: 20px auto;
            position: relative;
            border-radius: 5px;
        }

        .test-section .progress-bar #progress-bar {
            height: 100%;
            width: 0%;
            background-color: #a3a3a3;
            border-radius: 5px;
            transition: width 0.3s;
        }

        .test-section .question-number {
            font-size: 1.2em;
            margin: 20px 0 10px 0;
            font-family: 'Apple SD Gothic Neo', sans-serif;
            color: #000;
        }

        .test-section .question-text {
            font-size: 1.5em;
            margin: 10px 0;
            font-family: 'Apple SD Gothic Neo', sans-serif;
            color: #000;
        }

        .test-section .divider {
            width: 50px;
            height: 2px;
            background-color: #e0e0e0;
            margin: 10px auto 20px auto;
        }

        .test-section .options-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .test-section .option-button {
            width: 100%; /* 폭을 100%로 설정 */
            max-width: 500px; /* 최대 너비 설정 */
            padding: 15px;
            margin: 10px 0;
            border-radius: 30px;
            border: 2px solid #000;
            background-color: #f8f7f2;
            color: #000000;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        .test-section .option-button:hover {
            background-color: #000000;
            color: #ffffff;
        }

        /* 제출 버튼 컨테이너 스타일 */
        .submit-button-container {
            width: 100%;
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* 결과 페이지 스타일 */
        .result {
            display: none;
            margin: 20px 0; 
            text-align: center;
            width: 100%;
            max-width: 800px;
            padding: 20px;
            box-sizing: border-box;
        }

        .result h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .image-viewer img { 
            width: 100%; 
            max-width: 600px; 
            margin-bottom: 20px;
        }

        button { 
            margin-top: 10px; 
            padding: 10px; 
            cursor: pointer;
            font-size: 1em;
        }

        .navigation-buttons { 
            margin-top: 20px; 
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* 선택 페이지 스타일 */
        .selection-page {
            display: none;
            text-align: center;
            width: 100%;
            max-width: 800px;
            padding: 20px;
            box-sizing: border-box;
        }

        .selection-page h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .selection-page button {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            margin: 10px 0;
            border-radius: 30px;
            border: 2px solid #000;
            background-color: #f8f7f2;
            color: #000000;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        .selection-page button:hover {
            background-color: #000000;
            color: #ffffff;
        }

        /* 공통 버튼 스타일 */
        .styled-button {
            padding: 10px 20px;
            background-color: #000000;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 1em;
        }

        .styled-button:hover {
            background-color: #444444;
        }

        /* 결과 제출 버튼 스타일 */
        #submit-test {
            /* 공통 스타일을 사용하므로 추가 스타일 제거 */
            display: none; /* 초기 상태는 숨김 */
        }

        /* 홈 페이지 반응형 스타일 - 스마트폰 */
        @media (max-width: 600px) {
            .header {
                font-size: 14px;
                padding: 8px 16px;
            }

            .subtitle {
                font-size: 14px;
            }

            .button-container {
                width: 90%;
            }

            .button {
                height: 40px;
            }

            .button.left, .button.right {
                width: 130px;
            }

            .test-section .option-button {
                width: 100%; /* 폭을 100%로 설정 */
                max-width: 100%; /* 최대 너비를 100%로 설정 */
            }

            .selection-page button {
                max-width: 100%; /* 최대 너비를 100%로 설정 */
            }
        }

        /* 홈 페이지 반응형 스타일 - 큰 화면 */
        @media (min-width: 1200px) {
            .image-container img {
                width: 50%; /* 큰 화면에서는 이미지가 약간 작게 */
            }
        }
    </style>
</head>
<body class="home-background"> 

    <!-- 홈 페이지 콘텐츠 -->
    <div id="home-screen">
        <!-- 좌상단 제 1회 텍스트 -->
        <div class="header">제 1회</div>

        <!-- 이미지 위치 -->
        <div class="image-container">
            <img src="image/혐오인지능력시험_검정.png" alt="혐오인지능력시험 이미지"> <!-- 이미지 경로 확인 필요 -->
        </div>

        <!-- 중앙 긴 선 -->
        <div class="main-line"></div>

        <!-- 버튼 컨테이너 -->
        <div class="button-container">
            <div class="button left" onclick="showResultSelectionPage()">
                <div class="left-arrow">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 18l-6-6 6-6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div> <!-- 왼쪽 화살표 -->
                <div class="separator"></div> <!-- 검은색 구분선 -->
                <div class="right-text">점수 확인하기</div> <!-- 글씨 크기를 줄여서 한 줄로 표시 -->
            </div>
            <div class="button right" onclick="startTest()">
                <div class="right-button">
                    <div class="right-text">시험 응시하기</div>
                    <div class="separator" style="border-left: 2px solid black; height: 40px;"></div> <!-- 오른쪽 구분선 -->
                    <div class="right-arrow">
                        &gt;
                    </div>
                </div>
            </div>
        </div>

        <!-- 하단 설명 텍스트 -->
        <div class="footer">
            *혐오인지능력시험은 일상 속에 숨어있는 혐오표현들에 대해 알아갈 기회를 마련하는 시험입니다.
        </div>
    </div>

    <!-- 결과 확인 페이지 (선택 페이지) -->
    <div class="selection-page">
        <h2>당신의 점수는?</h2>
        <button class="styled-button" onclick="showImage('0-30')">0 - 30</button>
        <button class="styled-button" onclick="showImage('40-70')">40 - 70</button>
        <button class="styled-button" onclick="showImage('80-100')">80 - 100</button>
    </div>

    <!-- 결과 페이지 -->
    <div class="result">
        <h2>결과</h2>
        <div class="image-viewer">
            <img id="result-image" src="" alt="심리 테스트 결과 이미지">
        </div>
        <div class="navigation-buttons">
            <button id="home-btn" class="styled-button" onclick="goHome()">홈으로 돌아가기</button>
            <button id="download-btn" class="styled-button" style="display:none;" onclick="downloadPDF()">결과 PDF 다운로드</button>
            <button id="print-btn" class="styled-button" style="display:none;" onclick="printPDF()">결과 인쇄</button>
            <button id="kakao-share-btn" class="styled-button" style="display:none;" onclick="shareKakao()">카카오톡으로 결과 공유</button>
        </div>
    </div>

    <!-- 심리 테스트 섹션 -->
    <div class="test-section">
        <div class="progress-bar">
            <div id="progress-bar" class="progress-fill"></div>
        </div>

        <div class="question-number" id="question-number">Q1</div>
        <div class="question-text" id="question-text">질문이 로드되는 중입니다...</div>
        <div class="divider"></div>

        <div class="options-container" id="test-container">
            <!-- 선택지 버튼은 JavaScript에 의해 동적으로 생성됩니다 -->
        </div>

        <div class="submit-button-container">
            <button id="submit-test" class="styled-button" onclick="submitTest()" style="display:none;">결과 제출</button>
        </div>
    </div>

    <!-- Kakao SDK -->
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script>
        Kakao.init('c817ee8f357d0b759f84810124efd582'); // 실제 앱 키로 교체하세요.

        // 이미지 파일 경로 설정
        const imagePaths = {
            '0-30': 'image/0_30.png',
            '40-70': 'image/40_70.png',
            '80-100': 'image/80_100.png'
        };

        // PDF 파일 경로 설정
        const pdfPaths = {
            '0-30': 'pdf/result_0_to_30.pdf',
            '40-70': 'pdf/result_40_to_70.pdf',
            '80-100': 'pdf/result_80_to_100.pdf'
        };

        let currentResult = '';
        const totalQuestions = 10;
        let currentQuestionIndex = 0;
        let answers = {};
        const questions = [
            {
                question: '다른 사람과 잘 어울리는 편인가요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 1
            },
            {
                question: '어려운 문제를 해결하는 것을 좋아하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 2
            },
            {
                question: '어떤 일을 할 때 완벽하게 하려고 하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 0
            },
            {
                question: '모임에서 리더 역할을 자주 하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 3
            },
            {
                question: '계획을 세우고 실행하는 것을 좋아하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 1
            },
            {
                question: '새로운 것을 배우는 것을 좋아하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 0
            },
            {
                question: '감정을 잘 표현하는 편인가요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 4
            },
            {
                question: '여행을 자주 다니는 편인가요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 1
            },
            {
                question: '책을 자주 읽는 편인가요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 3
            },
            {
                question: '운동을 좋아하나요?',
                choices: ['매우 그렇다', '그렇다', '보통이다', '아니다', '매우 아니다'],
                correctAnswer: 0
            }
        ];

        // 초기 화면 설정
        function showResultSelectionPage() {
            hideAllScreens();
            document.body.classList.remove('home-background', 'test-background');
            document.body.classList.add('result-background'); // 결과 페이지 배경 설정
            document.querySelector('.selection-page').style.display = 'block'; // 선택 페이지 표시
        }

        function startTest() {
            hideAllScreens();
            document.body.classList.remove('home-background', 'result-background');
            document.body.classList.add('test-background'); // 테스트 페이지 배경 설정
            document.querySelector('.test-section').style.display = 'block';
            generateTestQuestions();
            updateProgressBar(); // 초기 진행 상태 업데이트
        }

        function showImage(resultKey) {
            const imagePath = imagePaths[resultKey];
            document.getElementById('result-image').src = imagePath;
            document.querySelector('.image-viewer').style.display = 'block';
            document.getElementById('download-btn').style.display = 'block';
            document.getElementById('print-btn').style.display = 'block';
            document.getElementById('kakao-share-btn').style.display = 'block';
            document.getElementById('home-btn').style.display = 'block'; // 홈으로 돌아가기 버튼 표시
            currentResult = resultKey; // 현재 결과 저장
            updateURL(resultKey); // URL 업데이트

            // 결과 페이지 표시
            hideAllScreens();
            document.body.classList.remove('home-background', 'test-background');
            document.body.classList.add('result-background'); // 결과 페이지 배경 설정
            document.querySelector('.result').style.display = 'block'; // 결과 페이지 표시
        }

        // URL 업데이트 함수
        function updateURL(resultKey) {
            const newUrl = `${window.location.origin}${window.location.pathname}?result=${resultKey}`;
            window.history.replaceState({ path: newUrl }, '', newUrl);
        }

        // 페이지 로드 시 URL의 파라미터 확인
        window.onload = function() {
            const resultParam = getParameterByName('result');
            if (resultParam) {
                hideAllScreens();
                document.body.classList.remove('home-background', 'test-background');
                document.body.classList.add('result-background');
                document.querySelector('.result').style.display = 'block';
                showImage(resultParam);
            }
        };

        function downloadPDF() {
            const pdfLink = pdfPaths[currentResult];
            const link = document.createElement('a');
            link.href = pdfLink;
            link.download = `${currentResult}_result.pdf`;
            link.click();
        }

        function printPDF() {
            const pdfLink = pdfPaths[currentResult];
            const printWindow = window.open(pdfLink, '_blank');
            printWindow.onload = function() {
                printWindow.print();
            };
        }

        function shareKakao() {
            const result = `심리 테스트 결과를 확인하세요! (${currentResult})`;
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: '심리 테스트 결과',
                    description: result,
                    imageUrl: imagePaths[currentResult],
                    link: {
                        mobileWebUrl: window.location.href,  // 현재 페이지 URL 사용
                        webUrl: window.location.href  // 데스크탑 웹 URL 사용
                    }
                },
                buttons: [
                    {
                        title: '결과 확인하기',
                        link: {
                            mobileWebUrl: window.location.href,
                            webUrl: window.location.href
                        }
                    }
                ]
            }).then(function() {
                alert('카카오톡으로 공유하기 성공!');
                // 결과 페이지로 다시 돌아가기
                hideAllScreens();
                document.body.classList.remove('home-background', 'test-background');
                document.body.classList.add('result-background'); // 결과 페이지 배경 설정
                document.querySelector('.result').style.display = 'block'; // 결과 페이지 표시
                showImage(currentResult); // 현재 결과 이미지 표시
            }).catch(function(error) {
                alert('카카오톡 공유 실패: ' + JSON.stringify(error));
            });
        }

        // 심리테스트 질문 생성
        function generateTestQuestions() {
            const testContainer = document.getElementById('test-container');
            const questionNumber = document.getElementById('question-number');
            const questionText = document.getElementById('question-text');

            // 초기 질문 설정
            displayQuestion(currentQuestionIndex);

            // 선택지 버튼은 사용자 클릭 시 이벤트를 통해 처리
        }

        function displayQuestion(index) {
            const questionNumber = document.getElementById('question-number');
            const questionText = document.getElementById('question-text');
            const testContainer = document.getElementById('test-container');

            // 현재 질문 번호와 텍스트 설정
            questionNumber.innerText = `Q${index + 1}`;
            questionText.innerText = questions[index].question;

            // 선택지 버튼 생성
            testContainer.innerHTML = '';
            questions[index].choices.forEach((choice, choiceIndex) => {
                const button = document.createElement('div');
                button.classList.add('option-button');
                button.innerText = choice;
                button.onclick = function() {
                    selectAnswer(index, choiceIndex);
                };
                testContainer.appendChild(button);
            });
        }

        function selectAnswer(questionNumber, answerIndex) {
            answers[questionNumber] = answerIndex;
            // 각 문제마다 사용자가 선택지를 선택하면 다음 문제로 이동하도록 설정
            if (questionNumber + 1 < totalQuestions) {
                currentQuestionIndex++; // 현재 질문 인덱스 업데이트
                updateProgressBar(); // 진행 상태 업데이트
                displayQuestion(currentQuestionIndex); // 다음 질문 표시
            } else {
                currentQuestionIndex++; // 마지막 질문에서도 인덱스 증가
                updateProgressBar(); // 마지막 질문 진행 상태 업데이트 (100% 표시)
                document.getElementById('submit-test').style.display = 'block'; // 제출 버튼 표시
            }
        }

        function submitTest() {
            let score = 0;
            for (let i = 0; i < totalQuestions; i++) {
                if (answers[i] === questions[i].correctAnswer) {
                    score += 10; // 정답당 10점씩 부여
                }
            }

            let resultKey;
            if (score <= 30) {
                resultKey = '0-30';
            } else if (score <= 70) {
                resultKey = '40-70';
            } else {
                resultKey = '80-100';
            }

            // 결과 페이지 배경으로 변경
            document.body.classList.remove('home-background', 'test-background');
            document.body.classList.add('result-background'); 

            hideAllScreens();
            document.querySelector('.result').style.display = 'block';
            showImage(resultKey);
        }

        // 진행 상태 업데이트 함수
        function updateProgressBar() {
            const progressBar = document.getElementById('progress-bar');
            const progressPercentage = ((currentQuestionIndex) / totalQuestions) * 100;
            progressBar.style.width = progressPercentage + '%';
        }

        // 홈으로 돌아가기 버튼 기능
        function goHome() {
            hideAllScreens();
            document.body.classList.remove('test-background', 'result-background');
            document.body.classList.add('home-background'); // 홈 페이지 배경 설정
            document.querySelector('#home-screen').style.display = 'flex'; // 홈 화면 표시
            // 초기화
            currentQuestionIndex = 0;
            answers = {}; // 답변 초기화
            currentResult = ''; // 결과 초기화
            document.getElementById('submit-test').style.display = 'none';
            updateProgressBar();

            // URL에서 쿼리 파라미터 제거
            const newUrl = `${window.location.origin}${window.location.pathname}`;
            window.history.replaceState({}, document.title, newUrl);
        }

        // 모든 화면 숨기기 함수
        function hideAllScreens() {
            document.querySelector('#home-screen').style.display = 'none';
            document.querySelector('.result').style.display = 'none';
            document.querySelector('.test-section').style.display = 'none';
            document.querySelector('.selection-page').style.display = 'none'; // 선택 페이지 숨기기
        }

        // URL 파라미터 가져오기 함수
        function getParameterByName(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }
    </script>
</body>
</html>
